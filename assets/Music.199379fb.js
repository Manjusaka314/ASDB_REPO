import{E as i,h as e}from"./hca.1ae2a8f7.js";import{E as s}from"./index.d91a3b3a.js";import{G as t,z as a,p as n,i as c,o as u,c as o,a as r,t as m,F as d,r as _,b as l,d as g,h,g as p}from"./index.c0e2940b.js";import"./@pixi.ba7a7c6f.js";const f={inject:["socket"],data:()=>({music:[],selected_music:void 0,s_tag:1,avaliable_tags:[],image_size:0,music_source:void 0,running:!1,running_music_name:void 0}),computed:{music_with_tag:function(){if(0==this.music.length)return[];let i=[];return this.music.forEach((e=>{i.find((i=>i.tag==e.tag))||i.push({tag:e.tag,music:[]}),i.find((i=>i.tag==e.tag)).music.push({name:e.name,author:e.author,icon:e.icon,duration:e.duration,acb:e.acb,cue:e.cue})})),i}},watch:{running:function(i,e){!i&&e&&this.music_source&&this.music_source.stop()}},mounted(){this.image_size=this.get_image_size();const i=localStorage.getItem("game_lang");let e=this;t(a((()=>({exSubtitle:e.running&&"Music"==this.$route.name&&e.running_music_name||""})))),this.socket.emit("get_music_data",[i],(function(i){i.forEach((i=>{-1==e.avaliable_tags.indexOf(i.tag)&&e.avaliable_tags.push(i.tag)})),e.music=i})),window.onresize=function(){e.image_size=e.get_image_size()}},methods:{processNewTag:function(i){$('[id^="tag_"]').removeClass("active"),this.s_tag=i,$("#tag_"+i).addClass("active")},processNewSelect:function(t){let a=this;if(this.running&&(this.running=!1,t.name==this.selected_music.name))return;const n=t.acb.replace(".acb",""),c=window.AudioContext||window.webkitAudioContext||!1;c?i.get("/criware/"+n+"/"+t.cue+".hca",{responseType:"arraybuffer"}).then((i=>{let n=s.Buffer.from(i.data),u=e.decodeHcaToWav(n,"1564789515523",0,void 0,void 0),o=new c;o.resume().then((()=>{o.decodeAudioData(u.buffer).then((i=>{a.running&&a.music_source||(a.selected_music=t,a.running=!0,a.music_source=o.createBufferSource(),a.music_source.connect(o.destination),a.music_source.loop=!0,a.music_source.onended=function(){a.running=!1},a.music_source.buffer=i,a.music_source.start(),a.running_music_name=t.name)}))}))})):alert(this.$i18n.t("error.web_audio_api_not_supported"))},get_image_size:function(){const i=window.screen.width;return 512>i?i:512},timeFormat:i=>String(parseInt(i/60)).padStart(2,"0")+":"+(i=String(i%60).padStart(2,"0"))}},w=h("data-v-2825550e");n("data-v-2825550e");const v={id:"music"},b={id:"music_icon"},y={id:"music_info"},k={id:"music_title",style:{"font-weight":"bolder"}},x=r("br",null,null,-1),z={id:"music_author"},S={id:"music_main",style:{width:"100%"}},C={id:"music_tag_menu"},j={key:0,id:"music_menu"},T={id:"music_list"},E={class:"music_entity_left"},N={style:{"font-weight":"700"}},A=r("br",null,null,-1);c();const F=w(((i,e,s,t,a,n)=>{const c=p("lazy");return u(),o(d,null,[r("div",v,[r("div",b,[r("img",{id:"music_img",src:a.selected_music?"/music/"+a.selected_music.icon+"_scale.png":"/music/tujian_music_33_scale.png",width:a.image_size},null,8,["src","width"]),r("div",y,[r("span",k,m(a.selected_music?a.selected_music.name:i.$t("music.title")),1),x,r("span",z,m(a.selected_music?a.selected_music.author:i.$t("music.powered")),1)])]),r("div",S,[r("div",C,[(u(!0),o(d,null,_(a.avaliable_tags,(i=>l((u(),o("img",{id:"tag_"+i,key:"tag_icon_"+i,class:1==i?"active":"",width:"40",height:"40",style:{padding:"0 10px",cursor:"pointer"},onClick:e=>n.processNewTag(i)},null,10,["id","onClick"])),[[c,"/music/uimusic_tag_"+i+".png"]]))),128))]),0!=n.music_with_tag.length?(u(),o("div",j,[r("div",T,[(u(!0),o(d,null,_(n.music_with_tag.find((i=>i.tag==a.s_tag)).music,(i=>(u(),o("div",{key:"music_"+i.name,class:"music_entity"},[r("div",E,[r("span",N,m(i.name),1),r("span",{class:"music_duration",innerHTML:n.timeFormat(i.duration)},null,8,["innerHTML"]),A,r("span",null,m(i.author),1)]),r("i",{id:"music_btn_"+i.id,class:"fa fa-3x music_entity_right "+(a.selected_music&&i.name==a.selected_music.name&&a.running?"fa-stop-circle":"fa-play-circle"),onClick:e=>n.processNewSelect(i)},null,10,["id","onClick"])])))),128))])])):g("",!0)])]),r("p",null,m(i.$t("error.music_ios_13")),1)],64)}));f.render=F,f.__scopeId="data-v-2825550e";export default f;
