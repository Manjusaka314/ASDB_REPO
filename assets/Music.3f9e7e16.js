import{E as i,h as e}from"./hca.1ae2a8f7.js";import{E as s}from"./index.d91a3b3a.js";import{u as t,j as a,p as c,e as n,o as u,c as o,a as r,t as m,F as d,r as _,d as l,g}from"./index.d550c4e9.js";import"./@pixi.ba7a7c6f.js";const h={inject:["socket"],data:()=>({music:[],selected_music:void 0,s_tag:1,avaliable_tags:[],image_size:0,music_source:void 0,running:!1,running_music_name:void 0}),computed:{music_with_tag:function(){if(0==this.music.length)return[];let i=[];return this.music.forEach((e=>{i.find((i=>i.tag==e.tag))||i.push({tag:e.tag,music:[]}),i.find((i=>i.tag==e.tag)).music.push({name:e.name,author:e.author,icon:e.icon,duration:e.duration,acb:e.acb,cue:e.cue})})),i}},watch:{running:function(i,e){!i&&e&&this.music_source&&this.music_source.stop()}},mounted(){this.image_size=this.get_image_size();const i=localStorage.getItem("game_lang");let e=this;t(a((()=>({exSubtitle:e.running&&"Music"==this.$route.name&&e.running_music_name||""})))),this.socket.emit("get_music_data",[i],(function(i){i.forEach((i=>{-1==e.avaliable_tags.indexOf(i.tag)&&e.avaliable_tags.push(i.tag)})),e.music=i})),window.onresize=function(){e.image_size=e.get_image_size()}},methods:{processNewTag:function(i){$('[id^="tag_"]').removeClass("active"),this.s_tag=i,$("#tag_"+i).addClass("active")},processNewSelect:function(t){let a=this;if(this.running&&(this.running=!1,t.name==this.selected_music.name))return;const c=t.acb.replace(".acb",""),n=window.AudioContext||window.webkitAudioContext||!1;n?i.get("/criware/"+c+"/"+t.cue+".hca",{responseType:"arraybuffer"}).then((i=>{let c=s.Buffer.from(i.data),u=e.decodeHcaToWav(c,"1564789515523",0,void 0,void 0),o=new n;o.resume().then((()=>{o.decodeAudioData(u.buffer).then((i=>{a.running&&a.music_source||(a.selected_music=t,a.running=!0,a.music_source=o.createBufferSource(),a.music_source.connect(o.destination),a.music_source.loop=!0,a.music_source.onended=function(){a.running=!1},a.music_source.buffer=i,a.music_source.start(),a.running_music_name=t.name)}))}))})):alert(this.$i18n.t("error.web_audio_api_not_supported"))},get_image_size:function(){const i=window.screen.width;return 512>i?i:512},timeFormat:i=>String(parseInt(i/60)).padStart(2,"0")+":"+(i=String(i%60).padStart(2,"0"))}},p=g("data-v-47b1b6c4");c("data-v-47b1b6c4");const f={id:"music"},w={id:"music_icon"},b={id:"music_info"},v={id:"music_title",style:{"font-weight":"bolder"}},y=r("br",null,null,-1),k={id:"music_author"},x={id:"music_main",style:{width:"100%"}},S={id:"music_tag_menu"},z={key:0,id:"music_menu"},C={id:"music_list"},j={class:"music_entity_left"},T={style:{"font-weight":"700"}},E=r("br",null,null,-1);n();const N=p(((i,e,s,t,a,c)=>(u(),o(d,null,[r("div",f,[r("div",w,[r("img",{id:"music_img",src:a.selected_music?"/music/"+a.selected_music.icon+"_scale.png":"/music/tujian_music_33_scale.png",width:a.image_size},null,8,["src","width"]),r("div",b,[r("span",v,m(a.selected_music?a.selected_music.name:i.$t("music.title")),1),y,r("span",k,m(a.selected_music?a.selected_music.author:i.$t("music.powered")),1)])]),r("div",x,[r("div",S,[(u(!0),o(d,null,_(a.avaliable_tags,(i=>(u(),o("img",{id:"tag_"+i,key:"tag_icon_"+i,class:1==i?"active":"",src:"/music/uimusic_tag_"+i+".png",width:"40",height:"40",style:{padding:"0 10px",cursor:"pointer"},onClick:e=>c.processNewTag(i)},null,10,["id","src","onClick"])))),128))]),0!=c.music_with_tag.length?(u(),o("div",z,[r("div",C,[(u(!0),o(d,null,_(c.music_with_tag.find((i=>i.tag==a.s_tag)).music,(i=>(u(),o("div",{key:"music_"+i.name,class:"music_entity"},[r("div",j,[r("span",T,m(i.name),1),r("span",{class:"music_duration",innerHTML:c.timeFormat(i.duration)},null,8,["innerHTML"]),E,r("span",null,m(i.author),1)]),r("i",{id:"music_btn_"+i.id,class:"fa fa-3x music_entity_right "+(a.selected_music&&i.name==a.selected_music.name&&a.running?"fa-stop-circle":"fa-play-circle"),onClick:e=>c.processNewSelect(i)},null,10,["id","onClick"])])))),128))])])):l("",!0)])]),r("p",null,m(i.$t("error.music_ios_13")),1)],64))));h.render=N,h.__scopeId="data-v-47b1b6c4";export default h;
